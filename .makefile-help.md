# Makefile 使用说明

## 快速开始

### 启动所有服务
```bash
make start
```
这会自动：
1. 检查并清理端口占用
2. 编译后端程序（如果需要）
3. 安装前端依赖（如果需要）
4. 启动后端和前端服务

### 停止所有服务
```bash
make stop
```

### 重启所有服务
```bash
make restart
```

## 常用命令

### 服务管理

| 命令 | 说明 |
|------|------|
| `make start` | 启动所有服务（后端 + 前端） |
| `make start-backend` | 仅启动后端服务 |
| `make start-frontend` | 仅启动前端服务 |
| `make stop` | 停止所有服务 |
| `make stop-backend` | 停止后端服务 |
| `make stop-frontend` | 停止前端服务 |
| `make restart` | 重启所有服务 |
| `make status` | 查看服务状态 |

### 开发模式

| 命令 | 说明 |
|------|------|
| `make dev-backend` | 前台运行后端服务（方便查看日志） |
| `make dev-frontend` | 前台运行前端服务（方便查看日志） |

### 依赖管理

| 命令 | 说明 |
|------|------|
| `make install` | 安装所有依赖 |
| `make install-backend` | 安装后端依赖 |
| `make install-frontend` | 安装前端依赖 |

### 构建和清理

| 命令 | 说明 |
|------|------|
| `make build-backend` | 编译后端程序 |
| `make clean` | 清理生成的文件 |

### 日志查看

| 命令 | 说明 |
|------|------|
| `make logs-backend` | 查看后端日志 |
| `make logs-frontend` | 查看前端日志 |
| `make logs` | 查看后端日志（默认） |

### 工具命令

| 命令 | 说明 |
|------|------|
| `make check-ports` | 检查端口占用情况 |
| `make help` | 显示帮助信息 |

## 端口说明

- **后端端口**: 8080
- **前端端口**: 3000

## 注意事项

1. **端口占用**: Makefile会自动检查端口占用，如果被占用会自动清理
2. **后台运行**: `make start` 会在后台运行服务，日志会写入文件
3. **开发模式**: `make dev-*` 会在前台运行，方便查看实时日志
4. **日志文件**: 
   - 后端日志: `backend.log`
   - 前端日志: `frontend.log`

## 故障排查

### 服务启动失败

1. 检查端口是否被占用：
   ```bash
   make check-ports
   ```

2. 手动清理端口：
   ```bash
   make kill-port-8080  # 清理后端端口
   make kill-port-3000  # 清理前端端口
   ```

3. 查看日志：
   ```bash
   make logs-backend
   make logs-frontend
   ```

### 依赖问题

如果遇到依赖问题，可以重新安装：
```bash
make clean
make install
```

## 示例工作流

### 首次启动
```bash
# 1. 安装依赖
make install

# 2. 启动所有服务
make start

# 3. 查看服务状态
make status
```

### 日常开发
```bash
# 开发模式（前台运行，方便调试）
make dev-backend   # 在一个终端
make dev-frontend  # 在另一个终端
```

### 生产部署
```bash
# 1. 清理旧文件
make clean

# 2. 安装依赖
make install

# 3. 编译后端
make build-backend

# 4. 启动所有服务
make start

# 5. 查看日志
make logs
```
